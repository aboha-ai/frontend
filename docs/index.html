<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>추천 여행지</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://ai-public.creatie.ai/gen_page/tailwind-custom.css"
      rel="stylesheet"
    />
    <!-- Axios 라이브러리 포함 -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 먼저 googleMap.js를 로드 (모듈로 로드) -->
    <!-- <script type="module" src="assets/js/googleMap.js"></script> -->

    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAb8P-xJKQkXwIMeA-MakTSMisMhDhcuNY&callback=initMap&libraries=places"
      async
      defer
    ></script>
  </head>

  <body class="font-sans bg-gray-50">
    <header
      class="h-[60px] px-4 flex items-center justify-between border-b border-gray-200"
    >
      <button class="text-2xl"><i class="fas fa-bars"></i></button>
      <div class="text-2xl font-bold">go</div>
      <img
        src="https://creatie.ai/ai/api/search-image?query=A professional headshot of a person&width=40&height=40"
        class="w-10 h-10 rounded-full object-cover"
      />
    </header>

    <nav class="flex border-b border-gray-200">
      <button
        id="맛집-tab"
        class="tab-button px-6 py-3 text-gray-600"
        onclick="changeTab('맛집')"
      >
        맛집
      </button>
      <button
        id="관광지-tab"
        class="tab-button px-6 py-3 bg-black text-white"
        onclick="changeTab('관광지')"
      >
        관광지
      </button>
      <button
        id="호텔-tab"
        class="tab-button px-6 py-3 text-gray-600"
        onclick="changeTab('호텔')"
      >
        호텔
      </button>
    </nav>

    <main class="flex relative">
      <div
        class="w-full sm:w-[30%] border-r border-gray-200 h-[calc(100vh-180px)] overflow-y-auto"
      >
        <div
          id="맛집-content"
          class="content-section p-4 border-b border-gray-200"
        ></div>
        <div
          id="관광지-content"
          class="content-section p-4 border-b border-gray-200"
        ></div>
        <div
          id="호텔-content"
          class="content-section p-4 border-b border-gray-200"
        ></div>
      </div>

      <!-- ✅ Google Maps 영역 -->
      <div
        id="map"
        class="w-full sm:w-[70%] h-[calc(100vh-60px)] top-0 left-0 z-10"
      ></div>

      <div class="w-full sm:w-[30%] p-4">
        <h3 class="text-xl font-bold mb-4" id="place-name">관광지 설명</h3>
        <img
          id="place-photo"
          class="w-full h-60 object-cover mb-4 rounded-md"
        />
        <p id="place-hours" class="text-sm text-gray-600"></p>
        <p id="place-price" class="text-sm text-gray-600"></p>
        <p id="place-description" class="text-sm text-gray-600"></p>
      </div>
    </main>

    <footer class="bg-white mt-12">
      <div class="max-w-8xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="text-center text-gray-500 text-sm">
          © 2025 아보하 여행. All rights reserved.
        </div>
      </div>
    </footer>

    <!-- 팝업을 위한 div -->
    <div id="modal" class="modal hidden">
      <div class="modal-content">
        <span id="close-btn" class="close-btn">&times;</span>
        <h2 id="popup-title"></h2>
        <p id="popup-description"></p>
      </div>
    </div>

    <!-- 새로 추천받기 버튼 -->
    <button
      id="refresh-btn"
      class="fixed bottom-4 right-4 bg-black text-white px-4 py-2 rounded-full shadow-lg"
    >
      🔄 추천 다시 받기
    </button>
  </body>
  <script src="assets/js/googleMap.js"></script>
  <script src="assets/js/api.js"></script>
  <script src="assets/js/tabHandler.js"></script>
  <script>
    let map;

    // Google Map 초기화
    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 37.5665, lng: 126.978 }, // 서울 좌표
        zoom: 12,
      });
    }

    // 마커를 클릭했을 때 장소 정보를 표시
    window.showLocation = function (location, name) {
      if (!map) {
        console.error("❌ Google Map is not initialized!");
        return;
      }

      // 기존 마커 제거
      const marker = new google.maps.Marker({
        position: location,
        map: map,
        animation: google.maps.Animation.DROP,
        title: name || "이 장소", // 마커에 표시될 제목
      });

      // 지도 중앙을 클릭한 장소로 이동
      map.setCenter(location);
      map.setZoom(14);

      // 구글 장소 검색 서비스
      const service = new google.maps.places.PlacesService(map);
      const request = {
        location: location,
        radius: 500, // 반경 500m 이내에서 검색
        query: name, // 장소 이름을 기준으로 검색
      };

      // 장소 검색
      service.textSearch(request, function (results, status) {
        if (status === google.maps.places.PlacesServiceStatus.OK) {
          // 검색 결과로 첫 번째 장소 표시
          const result = results[0];
          const infoWindow = new google.maps.InfoWindow({
            content: `<div><strong>${result.name}</strong><br>${result.formatted_address}</div>`,
          });

          // 마커 클릭 시 정보 창을 표시하도록 설정
          marker.addListener("click", function () {
            infoWindow.open(map, marker);
          });
        } else {
          console.error("❌ 구글 장소 검색 실패:", status);
        }
      });
    };
  </script>
</html>
